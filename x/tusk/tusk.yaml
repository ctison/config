name: x
usage: 42

options:
  pwd:
    environment: PWD

tasks:
  build-kali:
    options:
      options:
        usage: options to pass to docker build command
    run:
    - docker build -f ../docker/kali/Dockerfile -t ctison/kali ${options} ../../

  create-bin:
    args:
      NAME: {}
    run:
    - 'test ! -f ../../bin/${NAME}'
    - |
      /bin/sh -c '
      cat > ../../bin/${NAME} << EOF
      #!/bin/sh
      umask 0077
      set -ex
      
      EOF'
    - chmod 700 ../../bin/${NAME}

  create-bin-install:
    args:
      NAME: {}
    run:
    - 'test ! -f ../../bin/install/${NAME}'
    - |
        /bin/sh -c '
        cat > ../../bin/install/${NAME} << EOF
        #!/bin/sh
        umask 0077
        set -ex

        EOF'
    - chmod 700 ../../bin/install/${NAME}

  install:
    args:
      NAME: {}
    run: exec ../../bin/install/${NAME}