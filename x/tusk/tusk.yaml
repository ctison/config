name: x
usage: 42

options:
  pwd:
    environment: PWD

tasks:
  build-kali:
    options:
      options:
        usage: options to pass to docker build command
    run:
      - docker build -f ../docker/kali/Dockerfile -t ctison/kali ${options} ../../

  create-bin:
    args:
      NAME: {}
    run:
      - "test ! -f ../../bin/${NAME}"
      - |
        /bin/sh -c '
        cat > ../../bin/${NAME} << EOF
        #!/bin/sh
        umask 0077
        set -eux

        EOF'
      - chmod 700 ../../bin/${NAME}
      - type code >/dev/null 2>&1 && code ../../bin/${NAME}

  create-bin-install:
    args:
      NAME: {}
    run:
      - "test ! -f ../../bin/install/${NAME}"
      - |
        /bin/sh -c '
        cat > ../../bin/install/${NAME} << EOF
        #!/bin/sh
        umask 0077
        set -eux

        EOF'
      - chmod 700 ../../bin/install/${NAME}
      - type code >/dev/null 2>&1 && code ../../bin/install/${NAME}

  i:
    args:
      NAME: {}
    run: exec ../../bin/install/${NAME}
